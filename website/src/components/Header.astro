---
import type { Lang } from '../i18n/config';
import { STRINGS } from '../i18n/strings';
import LanguageSwitcher from './LanguageSwitcher.astro';
import { SITE } from '../config/site';

type Props = { lang: Lang; pathname: string };
const { lang, pathname } = Astro.props;
const s = STRINGS[lang];
const contactHref = `mailto:${SITE.email}`;

const basePath = `/${lang}/`;
const nav = [
	{ href: basePath, label: s.nav.home },
	{ href: `${basePath}app/`, label: s.nav.app },
	{ href: `${basePath}evidence/`, label: s.nav.evidence },
	{ href: `${basePath}faq/`, label: s.nav.faq },
	{ href: `${basePath}support/`, label: s.nav.support },
];
---

<header class="border-b border-slate-200/70 bg-white/70 backdrop-blur">
	<div class="mx-auto flex max-w-6xl items-center justify-between gap-4 px-4 py-4 sm:px-6 lg:px-8">
		<a href={basePath} class="flex items-center gap-3">
			<img src="/img/logo-400w.webp" width="40" height="40" alt="Pelvisana" class="h-10 w-10" loading="eager" />
			<span class="text-base font-semibold tracking-tight">{s.siteName}</span>
		</a>

		<nav aria-label="Primary" class="hidden items-center gap-6 md:flex">
			{nav.map((item) => {
	const isActive = pathname === item.href;
				return (
					<a
						href={item.href}
						class:list={[
							'text-sm font-medium text-slate-700 hover:text-slate-950',
							isActive && 'text-slate-950',
						]}
					>
						{item.label}
					</a>
				);
			})}
		</nav>

		<div class="flex items-center gap-3">
			<button
				id="mobile-menu-button"
				type="button"
				class="inline-flex items-center justify-center rounded-full border border-slate-300 bg-white p-2 text-slate-900 shadow-sm hover:bg-slate-50 md:hidden"
				aria-controls="mobile-menu"
				aria-expanded="false"
			>
				<span class="sr-only">Menu</span>
				<svg id="icon-open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<path d="M4 6h16" />
					<path d="M4 12h16" />
					<path d="M4 18h16" />
				</svg>
				<svg id="icon-close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hidden h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<path d="M18 6 6 18" />
					<path d="M6 6l12 12" />
				</svg>
			</button>
			<LanguageSwitcher lang={lang} pathname={pathname} />
			<a
				href={contactHref}
				class="hidden rounded-full bg-ink-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-ink-700 sm:inline-flex"
			>
				{s.cta.contact}
			</a>
		</div>
	</div>

	<div id="mobile-menu" class="hidden border-t border-slate-200/70 bg-white md:hidden">
		<nav aria-label="Mobile" class="mx-auto grid max-w-6xl gap-2 px-4 py-4 sm:px-6">
			{nav.map((item) => {
				const isActive = pathname === item.href;
				return (
					<a
						href={item.href}
						class:list={[
							'rounded-xl px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 hover:text-slate-950',
							isActive && 'bg-slate-50 text-slate-950',
						]}
					>
						{item.label}
					</a>
				);
			})}
			<a
				href={contactHref}
				class="mt-2 inline-flex items-center justify-center rounded-xl bg-ink-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-ink-700"
			>
				{s.cta.contact}
			</a>
		</nav>
	</div>
</header>

<script is:inline>
	(() => {
		const button = document.getElementById('mobile-menu-button');
		const menu = document.getElementById('mobile-menu');
		const iconOpen = document.getElementById('icon-open');
		const iconClose = document.getElementById('icon-close');
		if (!(button instanceof HTMLButtonElement) || !(menu instanceof HTMLElement)) return;

		const setOpen = (open) => {
			menu.classList.toggle('hidden', !open);
			button.setAttribute('aria-expanded', String(open));
			if (iconOpen instanceof SVGElement) iconOpen.classList.toggle('hidden', open);
			if (iconClose instanceof SVGElement) iconClose.classList.toggle('hidden', !open);
		};

		setOpen(false);
		button.addEventListener('click', () => setOpen(menu.classList.contains('hidden')));
		menu.addEventListener('click', (e) => {
			const target = e.target;
			if (target instanceof HTMLAnchorElement) setOpen(false);
		});
		window.addEventListener('keydown', (e) => {
			if (e.key === 'Escape') setOpen(false);
		});
		window.addEventListener('click', (e) => {
			if (menu.classList.contains('hidden')) return;
			const target = e.target;
			if (!(target instanceof Node)) return;
			if (menu.contains(target) || button.contains(target)) return;
			setOpen(false);
		});
	})();
</script>
