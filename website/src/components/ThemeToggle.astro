---
type Props = { compact?: boolean };
const { compact = false } = Astro.props;
---

<button
	id="theme-toggle"
	type="button"
	class:list={[
		'inline-flex items-center justify-center rounded-full border border-slate-300 bg-white p-2 text-slate-900 shadow-sm transition hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:bg-slate-800',
		compact ? 'h-9 w-9' : 'h-10 w-10',
	]}
	aria-label="Toggle dark mode"
>
	<svg id="theme-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hidden h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
		<circle cx="12" cy="12" r="4" />
		<path d="M12 2v2" />
		<path d="M12 20v2" />
		<path d="M4.93 4.93l1.41 1.41" />
		<path d="M17.66 17.66l1.41 1.41" />
		<path d="M2 12h2" />
		<path d="M20 12h2" />
		<path d="M4.93 19.07l1.41-1.41" />
		<path d="M17.66 6.34l1.41-1.41" />
	</svg>
	<svg id="theme-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hidden h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
		<path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z" />
	</svg>
</button>

<script is:inline>
	(() => {
		const root = document.documentElement;
		const button = document.getElementById('theme-toggle');
		const sun = document.getElementById('theme-sun');
		const moon = document.getElementById('theme-moon');
		if (!(button instanceof HTMLButtonElement)) return;

		const getPreferred = () => window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
		const readStored = () => {
			try {
				return localStorage.getItem('pelvisana_theme');
			} catch {
				return null;
			}
		};
		const writeStored = (value) => {
			try {
				localStorage.setItem('pelvisana_theme', value);
			} catch {}
		};

		const apply = (mode) => {
			const isDark = mode === 'dark';
			root.classList.toggle('dark', isDark);
			if (sun instanceof SVGElement) sun.classList.toggle('hidden', !isDark);
			if (moon instanceof SVGElement) moon.classList.toggle('hidden', isDark);
		};

		const init = () => {
			const stored = readStored();
			if (stored === 'dark' || stored === 'light') {
				apply(stored);
				return;
			}
			apply(getPreferred() ? 'dark' : 'light');
		};

		init();
		button.addEventListener('click', () => {
			const next = root.classList.contains('dark') ? 'light' : 'dark';
			writeStored(next);
			apply(next);
		});
	})();
</script>

